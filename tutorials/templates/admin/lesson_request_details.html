{% extends 'base_content.html' %}
{% block content %}

<head>
    <style>
    </style>
</head>

<div class="layout">
    {% include 'partials/sidebar.html' %}
    <div class="content" style="background-color: #F0F0F0;">
        <h2>Create a lesson plan</h2>
        <h5 class="h5"> For student: <span class="bg-danger text-white" style="padding: 2px 4.5px; font-weight: bold; border-radius: 5px;">{{ lesson_request.student.get_full_name }}</span></h5>
        <table class="table table-bordered">
            <tr>
            <th>Request ID</th>
            <td>{{ lesson_request.id }}</td>
            </tr>
            <tr>
            <th>Student Name</th>
            <td>{{ lesson_request.student.get_full_name }}</td>
            </tr>
            <tr>
            <th>Skill</th>
            <td>{{ lesson_request.skill }}</td>
            </tr>
            <tr>
            <th>Duration</th>
            <td>{{ lesson_request.duration }} minutes</td>
            </tr>
            <tr>
            <th>First Term</th>
            <td>{{ lesson_request.first_term }}</td>
            </tr>
            <tr>
            <th>Frequency</th>
            <td>{{ lesson_request.frequency }}</td>
            </tr>
            <tr>
            <th>Date Requested</th>
            <td>{{ lesson_request.created_at }}</td>
            </tr>
            <tr>
            <th>Status</th>
            <td>{{ lesson_request.get_status_display }}</td>
            </tr>
        </table>

        <hr>

        <p>Kindly review the lesson request details provided above and proceed with the necessary actions. <br> <b>Next step:</b> Select a tutor to initiate the lesson plan.</p>

        <!-- Tutor List -->
        <h4>Select a Tutor</h4>
        <!-- Search Form -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center" style="padding-bottom: 0.5rem;">
            <form method="get" action="" class="mb-2 mb-md-0 w-md-auto">
                <div class="input-group">
                    <input type="text" class="form-control" name="search" placeholder="Search skill / name" value="{{ request.GET.search }}">
                    <button class="btn btn-outline-secondary" type="submit">Search</button>
                </div>
            </form>
            <h6 class="text-left text-md-right w-100 w-md-auto"><i>Click on fields (e.g. Name) to sort</i></h6>
        </div>

        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Skill</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for tutor_info in tutors_with_skills %}
                <tr>
                    <td>{{ tutor_info.tutor.get_full_name }}</td>
                    <td>{{ tutor_info.tutor.email }}</td>
                    <td style="text-align: left;">
                        {% if tutor_info.skills %}
                            {% for tutor_skill in tutor_info.skills %}
                                {{ tutor_skill.skill.language }} ({{ tutor_skill.skill.level }}){% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        {% else %}
                            No skills assigned
                        {% endif %}
                    </td>
                    <td>
                        <a href="?assign_tutor={{ tutor_info.tutor.id }}" class="btn btn-sm btn-primary">
                            Assign {{ tutor_info.tutor.get_full_name }}
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">No tutors available</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>


        <!-- Decisions to make -->
        <a href="{% url 'manage_applications' %}" class="btn btn-primary" style="color: #fff;">Back to Applications</a>
        <td>
            <!-- Approve -->
            <form action="{% url 'update_request_status' lesson_request.id 'approve' %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-success" aria-label="Approve Request">Approve and Create Lesson Plan</button>
            </form>

            <!-- Reject -->
            <form action="{% url 'update_request_status' lesson_request.id 'reject' %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger" aria-label="Reject Request">Reject</button>
            </form>

            <!-- Pending -->
            <form action="{% url 'update_request_status' lesson_request.id 'pending' %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-warning" aria-label="Set to Pending">Pending</button>
            </form>
        </td>
    </div>
</div>

{% endblock %}
