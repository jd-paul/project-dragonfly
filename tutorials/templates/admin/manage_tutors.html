{% extends 'base_content.html' %}

{% block content %}
  <div class="container mt-4">
    <h1 class="text-center">Manage Pending Tutors</h1>

    <!-- Display success/error messages -->
    {% if messages %}
      <div class="alert alert-{{ message.tags }} mt-4">
        {% for message in messages %}
          <div>{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="row">
      <div class="col-12">
        <p class="lead">Total Pending Tutors: <strong>{{ tutor_count }}</strong></p>

        {% if tutors %}
          <div class="table-responsive">
            <table class="table table-bordered table-hover">
              <thead class="thead-dark">
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Skills</th>
                  <th>Hourly Rate</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for tutor in tutors %}
                  <tr>
                    <td>{{ tutor.user.get_full_name }}</td>
                    <td>{{ tutor.user.email }}</td>
                    <td>
                      {% for skill in tutor.skills.all %}
                        <span class="badge badge-info">{{ skill.name }}</span>
                      {% endfor %}
                    </td>
                    <td>{{ tutor.price_per_hour }} USD</td>
                    <td>
                      <form method="post" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="tutor_id" value="{{ tutor.id }}">
                        <button type="submit" name="action" value="approve" class="btn btn-success btn-sm">
                          <i class="fas fa-check-circle"></i> Approve
                        </button>
                      </form>
                      <form method="post" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="tutor_id" value="{{ tutor.id }}">
                        <button type="submit" name="action" value="reject" class="btn btn-danger btn-sm">
                          <i class="fas fa-times-circle"></i> Reject
                        </button>
                      </form>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- Pagination Controls -->
          <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
              {% if tutors.has_previous %}
                <li class="page-item">
                  <a class="page-link" href="?page=1" aria-label="First">
                    <span aria-hidden="true">&laquo;&laquo;</span>
                  </a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="?page={{ tutors.previous_page_number }}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                  </a>
                </li>
              {% endif %}

              {% for num in tutors.paginator.page_range %}
                {% if tutors.number == num %}
                  <li class="page-item active">
                    <span class="page-link">{{ num }}</span>
                  </li>
                {% else %}
                  <li class="page-item">
                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                  </li>
                {% endif %}
              {% endfor %}

              {% if tutors.has_next %}
                <li class="page-item">
                  <a class="page-link" href="?page={{ tutors.next_page_number }}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                  </a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="?page={{ tutors.paginator.num_pages }}" aria-label="Last">
                    <span aria-hidden="true">&raquo;&raquo;</span>
                  </a>
                </li>
              {% endif %}
            </ul>
          </nav>

        {% else %}
          <p>No pending tutor applications at the moment.</p>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}
